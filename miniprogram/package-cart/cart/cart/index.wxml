<!-- 购物车悬浮入口 -->
<t-fab
  wx:if="{{ showCartFab > 0 }}"
  id="cart-fab"
  icon="cart"
  button-props="{{ fabBtnProps }}"
  draggable
  usingCustomNavbar
  style="{{ fabStyle }}"
  bind:click="handleSwitchMode"
  aria-label="增加"
/>

<!-- 购物车展开面板 -->
<t-popup
  wx:if="{{ showCartPopup }}"
  id="cart-popup"
  placement="bottom"
  using-custom-navbar
  bind:visible-change="handleSwitchMode"
>
  <view class="container" slot="content">
    <!-- header: 取消 + 标题 + 确定 -->
    <view class="header">
      <view class="title">{{ '购物车' }}</view>
    </view>
    <scroll-view scroll-y class="content" type="list" scroll-into-view="{{ currentViewId }}">
      <view id="goods-info" />
      <block wx:for="{{ recordList }}" wx:for-item="record" wx:key="_id">
        <goods
          spuId="{{ record.spuId }}"
          skuId="{{ record.skuId }}"
          editable="{{ false }}"
          tagSuffix="cart"
        />
      </block>

      <view id="order-info" />
      <t-cell
        wx:if="{{ recordList.length > 0 }}"
        title="下单人"
        arrow
        hover
        note="{{ userName }}"
        bind:click="showUserPicker"
      />
      <t-cell
        wx:if="{{ recordList.length > 0 }}"
        title="买方"
        arrow
        hover
        note="{{ customerName }}"
        bind:click="showCustomerPicker"
      />
      <t-cell
        wx:if="{{ recordList.length > 0 }}"
        title="卖方"
        arrow
        hover
        note="{{ providerName }}"
        bind:click="showProviderPicker"
      />
    </scroll-view>

    <view class="block-button-wrapper">
      <t-steps current="{{ currentStep }}" bind:change="handleStepChange" theme="dot">
        <t-step-item
          wx:for="{{ steps }}"
          wx:key="index"
          title="{{ item.title }}"
          content="{{ item.content }}"
        />
      </t-steps>
      <t-button
        disabled="{{ recordList.length === 0 || !userName || !customerName || !providerName }}"
        theme="primary"
        size="large"
        shape="round"
        variant="outline"
        content="{{ '下单' }}"
        bind:tap="handleMakeOrder"
      />
    </view>
  </view>
</t-popup>
